<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>ink! eDSL basic elements</title>
    <meta name="generator" content="VuePress 1.8.2">
    <script src="https://cdn.jsdelivr.net/npm/react/umd/react.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/react-dom/umd/react-dom.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@babel/standalone/babel.min.js"></script>
    <link rel="alternate" type="application/atom+xml" href="https://patractlabs.github.io/substrate-contracts-book/atom.xml" title=" Atom Feed">
    <link rel="alternate" type="application/json" href="https://patractlabs.github.io/substrate-contracts-book/feed.json" title=" JSON Feed">
    <link rel="alternate" type="application/rss+xml" href="https://patractlabs.github.io/substrate-contracts-book/rss.xml" title=" RSS Feed">
    <link rel="manifest" href="/substrate-contracts-book/manifest.webmanifest" crossorigin="use-credentials">
    <meta name="description" content="">
    <meta property="og:url" content="/substrate-contracts-book/en/ink/edsl-basic.html">
    <meta property="og:title" content="ink! eDSL basic elements">
    <meta property="og:type" content="article">
    <meta property="og:locale" content="en-US">
    <meta property="og:locale:alternate" content="zh-CN">
    <meta name="twitter:card" content="summary_large_image">
    <meta property="article:author" content="patractlabs">
    <meta name="theme-color" content="#46bd87">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    
    <link rel="preload" href="/substrate-contracts-book/assets/css/0.styles.50204389.css" as="style"><link rel="preload" href="/substrate-contracts-book/assets/js/app.9e416bbf.js" as="script"><link rel="preload" href="/substrate-contracts-book/assets/js/layout-Layout.c63f724a.js" as="script"><link rel="preload" href="/substrate-contracts-book/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound.dd92595a.js" as="script"><link rel="preload" href="/substrate-contracts-book/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound~layout-Slide.d464c7d8.js" as="script"><link rel="preload" href="/substrate-contracts-book/assets/js/vendors~layout-Blog~layout-Layout.fa83db2a.js" as="script"><link rel="preload" href="/substrate-contracts-book/assets/js/page-ink!eDSLbasicelements.7a41db2d.js" as="script"><link rel="prefetch" href="/substrate-contracts-book/assets/js/86.d2391560.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/87.ac464de4.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/88.4413ae31.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/89.bc68f1fa.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/90.f3d154c9.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/layout-Blog.2fb8f0e2.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/layout-NotFound.ac6e8532.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/layout-Slide.84640c11.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/page--743a0c12.076481e1.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/page-@redspotchai.a448438d.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/page-@redspotgas-reporter.d89b67d0.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/page-@redspotpatract.5e6c382f.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/page-APIaccess.6bfe71b4.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/page-API接入.17acb837.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/page-AccessControl.22c85c7b.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/page-Ask!.3d9c13d5.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/page-Benchmark.5168216a.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/page-BriefintroductionofWasm.17d73b2f.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/page-Carpo.8a6c0e32.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/page-Configure.a449c022.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/page-Console.ddd9ee49.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/page-Contract.bb080d1c.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/page-ContractSystemOverview.fc84d6e9.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/page-Contractlanguage(framework).b2a8e073.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/page-Contractmodel.07bc3f5e.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/page-Design.1cc72b08.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/page-DesignBrief.1cce107f.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/page-ERC20.b0676ca3.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/page-Elara.0ab6cb1d.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/page-Europa.b429cc27.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/page-EuropaWasmexecutor.89825ed5.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/page-Europacontractexecutionloginformationinterpretation.5163c492.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/page-Europadebuggingexample.b489fa23.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/page-Europatutorial.0c50089a.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/page-Europa合约执行日志信息解释.a8bbf738.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/page-Europa的WasmBacktrace.da10194b.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/page-Europa调试示例.54e17ef0.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/page-Example.ce00b7a2.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/page-Gettingstarted.c6943ee9.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/page-Himalia.5e553ed0.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/page-Introduction.c1075aea.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/page-Metis.7cccfdc3.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/page-Overview.8ab37d6b.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/page-Patract.f3b87e59.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/page-Plugins.548dfeac.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/page-PublishDApp.d5b0ce03.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/page-QA.1a508bbc.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/page-Redspot.b43e709f.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/page-RuntimeEnvironment.56ebcb2a.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/page-Solang.21b0522b.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/page-SubstrateContractsBook.07c4c4c8.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/page-Substrate合约书.1205a625.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/page-Summary.f3d4a5d5.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/page-Tutorial.c42349d6.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/page-Wasm简要介绍.cf2b7a3f.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/page-cargo-contract.fa1eb96a.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/page-example.88d4aff7.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/page-go-patract.c9a22806.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/page-ink!Framework.30ee7030.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/page-ink!eDSL基础元素.5737f07d.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/page-ink!tutorial.0f0cc6b9.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/page-ink!与solidity的对比.a8bd4eef.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/page-ink!当前的坑.84ff09a4.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/page-ink!框架.64df940e.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/page-ink!跨合约调用.2c874de7.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/page-ink.25c683e4.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/page-pallet-contracts合约模块.d2f9cbf8.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/page-py-patract.46ab376d.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/page-tutorial.2fd6548d.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/page-zkMega.7f0ce666.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/page-介绍.5f6e2c47.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/page-发布DApp.d83b035a.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/page-合约模型.79cb41d0.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/page-合约综述.4bbe1f4a.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/page-合约语言（框架）.a13bb584.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/page-基础.4d1b1ddf.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/page-控制台console.dacb0430.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/page-插件.3d2aa0a8.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/page-设计.9de8d662.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/page-设计简述.213c6fb3.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/page-配置.8d3f8252.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/vendors~flowchart.abe9e88a.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/vendors~photo-swipe.dd9b6b8a.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/vendors~reveal.71721ccb.js">
    <link rel="stylesheet" href="/substrate-contracts-book/assets/css/0.styles.50204389.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container has-navbar has-sidebar has-anchor"><header class="navbar"><button class="sidebar-button"><span class="icon"></span></button> <a href="/substrate-contracts-book/en/" class="home-link router-link-active"><img src="/substrate-contracts-book/logo.svg" alt="" class="logo"> <!----> <!----></a> <div class="links"><button class="color-button"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="skin-icon"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4
        38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32
        51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0
        102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2
        6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4
        0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2
        9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224
        419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4
        470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0
        22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6
        12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128
        505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2
        16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8
        86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4
        80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6
        6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg> <div class="color-picker-menu" style="display:none;"><div class="theme-options"><ul class="themecolor-select"><label for="themecolor-select">Theme Color:</label> <li><a href="#" class="default-theme"></a></li> </ul> <div class="darkmode-toggle"><label for="darkmode-toggle" class="desc">Theme Mode:</label> <div class="darkmode-switch"><div class="item day"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon light-icon"><path d="M512 256a42.667 42.667 0 0 0 42.667-42.667V128a42.667 42.667 0 0 0-85.334 0v85.333A42.667 42.667 0 0 0 512 256zm384 213.333h-85.333a42.667 42.667 0 0 0 0 85.334H896a42.667 42.667 0 0 0 0-85.334zM256 512a42.667 42.667 0 0 0-42.667-42.667H128a42.667 42.667 0 0 0 0 85.334h85.333A42.667 42.667 0 0 0 256 512zm9.387-298.667a42.667 42.667 0 0 0-59.307 62.72l61.44 59.307a42.667 42.667 0 0 0 31.147 11.947 42.667 42.667 0 0 0 30.72-13.227 42.667 42.667 0 0 0 0-60.16zm459.946 133.974a42.667 42.667 0 0 0 29.44-11.947l61.44-59.307a42.667 42.667 0 0 0-57.6-62.72l-61.44 60.587a42.667 42.667 0 0 0 0 60.16 42.667 42.667 0 0 0 28.16 13.227zM512 768a42.667 42.667 0 0 0-42.667 42.667V896a42.667 42.667 0 0 0 85.334 0v-85.333A42.667 42.667 0 0 0 512 768zm244.48-79.36a42.667 42.667 0 0 0-59.307 61.44l61.44 60.587a42.667 42.667 0 0 0 29.44 11.946 42.667 42.667 0 0 0 30.72-12.8 42.667 42.667 0 0 0 0-60.586zm-488.96 0-61.44 59.307a42.667 42.667 0 0 0 0 60.586 42.667 42.667 0 0 0 30.72 12.8 42.667 42.667 0 0 0 28.587-10.666l61.44-59.307a42.667 42.667 0 0 0-59.307-61.44zM512 341.333A170.667 170.667 0 1 0 682.667 512 170.667 170.667 0 0 0 512 341.333z" fill="currentColor"></path></svg></div> <div class="item auto active"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon auto-icon"><path d="M460.864 539.072H564.8L510.592 376l-49.728 163.072zM872 362.368V149.504H659.648L510.528 0l-149.12 149.504H149.12v212.928L0 511.872l149.12 149.504v212.928h212.352l149.12 149.504 149.12-149.504h212.352V661.376l149.12-149.504L872 362.368zM614.464 693.12l-31.616-90.624H438.272l-31.616 90.624h-85.888l144.576-407.68h90.368l144.576 407.68h-85.824zm0 0" fill="currentColor"></path></svg></div> <div class="item night"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon dark-icon"><path d="M935.539 630.402c-11.43-11.432-28.674-14.739-43.531-8.354-46.734 20.103-96.363 30.297-147.508 30.297-99.59 0-193.221-38.784-263.64-109.203-108.637-108.637-139.61-270.022-78.908-411.148a39.497 39.497 0 0 0-51.886-51.887c-52.637 22.64-100.017 54.81-140.826 95.616-85.346 85.346-132.346 198.821-132.346 319.52 0 120.7 47.001 234.172 132.347 319.519S408.063 947.11 528.76 947.11c120.7 0 234.172-47.003 319.52-132.351 40.809-40.81 72.978-88.19 95.616-140.826a39.497 39.497 0 0 0-8.356-43.532z" fill="currentColor"></path></svg></div></div> <!----></div></div></div></button> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/substrate-contracts-book/en/" class="nav-link router-link-active"><i class="iconfont icon-home"></i>
  Doc
</a></div></nav> <div class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon i18n-icon" style="width:1rem;height:1rem;vertical-align:middle;margin-left:1rem;"><path d="M639.981 344.075c14.805 44.45 34.542 79.023 69.084 113.596 29.603-29.634 49.34-69.146 64.145-113.596H639.981zM314.33 591.024h128.29l-64.145-172.865-64.145 172.865z" fill="currentColor"></path> <path d="M807.746 116.882H215.643c-54.274 0-98.681 44.45-98.681 98.78v592.677c0 54.329 44.407 98.78 98.68 98.78h592.104c54.273 0 98.681-44.451 98.681-98.78V215.66c0-54.329-39.475-98.78-98.68-98.78zM565.971 754.01c-9.866 9.878-19.738 9.878-29.603 9.878-4.94 0-14.805 0-19.738-4.939-4.939-4.939-9.872 0-9.872-4.939s-4.932-9.878-9.865-19.756c-4.94-9.878-4.94-14.817-9.872-24.695L467.29 655.23H294.592l-19.737 54.33c-9.866 19.755-14.805 34.572-19.738 44.45-4.939 9.878-14.804 9.878-29.603 9.878-9.871 0-19.737-4.939-29.609-9.878-9.865-9.878-14.798-14.817-14.798-24.695 0-4.939 0-9.878 4.933-19.756 4.939-9.878 4.939-14.817 9.865-24.695l108.553-276.583c4.939-9.878 4.939-19.756 9.872-29.633 4.932-9.878 9.865-19.756 14.798-24.695 4.939-4.94 9.872-14.817 19.737-19.756 9.872-4.94 19.738-4.94 29.61-4.94 9.865 0 19.73 0 29.603 4.94 9.865 4.939 14.804 9.878 19.737 19.756 4.933 4.939 9.866 14.817 14.798 24.695 4.94 9.877 9.872 19.755 14.805 34.572l108.553 271.644c9.865 19.756 14.804 34.573 14.804 44.451-4.939 4.94-9.872 14.817-14.804 24.695zm271.378-192.62c-54.273-19.756-93.748-44.451-128.29-74.085-34.536 34.573-78.943 59.268-133.223 74.085l-14.798-24.695c54.273-14.817 98.68-34.573 133.223-69.146-34.542-34.573-64.145-79.024-74.017-128.413h-49.34V319.38h133.228c-9.877-14.817-19.743-34.573-29.609-49.39l14.799-4.94c9.871 14.818 24.676 34.574 34.542 54.33h123.35v24.695h-49.34c-14.798 49.39-39.468 93.84-69.077 123.474 34.541 29.634 74.01 54.329 128.29 69.146l-19.738 24.695z" fill="currentColor"></path></svg> <span class="arrow down"></span></button> <ul class="nav-dropdown"><li class="dropdown-item"><a href="/substrate-contracts-book/ink/edsl-basic/" class="nav-link"><!---->
  简体中文
</a></li><li class="dropdown-item"><a href="/substrate-contracts-book/en/ink/edsl-basic/" aria-current="page" class="nav-link router-link-exact-active router-link-active active"><!---->
  English
</a></li></ul></div></div></div> <a rel="noopener noreferrer" href="https://github.com/patractlabs/substrate-contracts-book" target="_blank" class="repo-link can-hide">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <nav class="sidebar-nav-links"><div class="nav-item"><a href="/substrate-contracts-book/en/" class="nav-link router-link-active"><i class="iconfont icon-home"></i>
  Doc
</a></div> <a rel="noopener noreferrer" href="https://github.com/patractlabs/substrate-contracts-book" target="_blank" class="repo-link">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/substrate-contracts-book/en/" aria-current="page" class="sidebar-link">Summary</a></li><li><section class="sidebar-group depth-0"><a href="/substrate-contracts-book/en/introduction" class="sidebar-heading clickable"><!----> <span class="title">Introduction</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/substrate-contracts-book/en/contracts/overview/" class="sidebar-link">Contract System Overview</a></li><li><a href="/substrate-contracts-book/en/contracts/model/" class="sidebar-link">Contract model</a></li><li><a href="/substrate-contracts-book/en/contracts/language/" class="sidebar-link">Contract language (framework)</a></li><li><a href="/substrate-contracts-book/en/contracts/wasm_first_step/" class="sidebar-link">Brief introduction of Wasm</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/substrate-contracts-book/en/ink/introduction" class="sidebar-heading clickable open"><!----> <span class="title">ink!</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/substrate-contracts-book/en/ink/tutorial/" class="sidebar-link">ink! tutorial</a></li><li><a href="/substrate-contracts-book/en/ink/framework/" class="sidebar-link">ink! Framework</a></li><li><a href="/substrate-contracts-book/en/ink/edsl-basic/" aria-current="page" class="active sidebar-link">ink! eDSL basic elements</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/substrate-contracts-book/en/ink/edsl-basic/#elements-of-edsl" class="sidebar-link">Elements of eDSL</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/substrate-contracts-book/en/ink/edsl-basic/#ink-contract" class="sidebar-link heading3">#[ink::contract]</a></li><li class="sidebar-sub-header"><a href="/substrate-contracts-book/en/ink/edsl-basic/#storage" class="sidebar-link heading3">storage</a></li><li class="sidebar-sub-header"><a href="/substrate-contracts-book/en/ink/edsl-basic/#constructor-message" class="sidebar-link heading3">constructor/message</a></li><li class="sidebar-sub-header"><a href="/substrate-contracts-book/en/ink/edsl-basic/#event" class="sidebar-link heading3">event</a></li></ul></li></ul></li><li><a href="/substrate-contracts-book/en/ink/call-contracts/" class="sidebar-link">ink! 跨合约调用</a></li><li><a href="/substrate-contracts-book/en/ink/ink-solidity/" class="sidebar-link">ink! 与solidity的对比</a></li><li><a href="/substrate-contracts-book/en/ink/cargo-contract/" class="sidebar-link">cargo-contract</a></li><li><a href="/substrate-contracts-book/en/ink/trap/" class="sidebar-link">ink! 当前的坑</a></li></ul></section></li><li><a href="/substrate-contracts-book/en/solang/introduction/" class="sidebar-link">Solang</a></li><li><section class="sidebar-group depth-0"><a href="/substrate-contracts-book/en/redspot/introduction" class="sidebar-heading clickable"><!----> <span class="title">Redspot</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/substrate-contracts-book/en/redspot/tutorial/" class="sidebar-link">tutorial</a></li><li><a href="/substrate-contracts-book/en/redspot/overview/" class="sidebar-link">Introduction</a></li><li><a href="/substrate-contracts-book/en/redspot/configuration/" class="sidebar-link">Configure</a></li><li><a href="/substrate-contracts-book/en/redspot/runtime-environment/" class="sidebar-link">Runtime Environment</a></li><li><a href="/substrate-contracts-book/en/redspot/console/" class="sidebar-link">Console</a></li><li><a href="/substrate-contracts-book/en/redspot/q-and-a/" class="sidebar-link">Q &amp; A</a></li><li><section class="sidebar-group is-sub-group depth-1"><a href="/substrate-contracts-book/en/redspot/plugin" class="sidebar-heading clickable"><!----> <span class="title">Plugin</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/substrate-contracts-book/en/redspot/plugin/redspot-chai/" class="sidebar-link">@redspot/chai</a></li><li><a href="/substrate-contracts-book/en/redspot/plugin/redspot-gas-reporter/" class="sidebar-link">@redspot/gas-reporter</a></li><li><a href="/substrate-contracts-book/en/redspot/plugin/redspot-patract/" class="sidebar-link">@redspot/patract</a></li></ul></section></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/substrate-contracts-book/en/europa/introduction" class="sidebar-heading clickable"><!----> <span class="title">Europa</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/substrate-contracts-book/en/europa/tutorial/" class="sidebar-link">Europa tutorial</a></li><li><a href="/substrate-contracts-book/en/europa/execution_info/" class="sidebar-link">Europa contract execution log information interpretation</a></li><li><a href="/substrate-contracts-book/en/europa/sample/" class="sidebar-link">Europa debugging example</a></li><li><a href="/substrate-contracts-book/en/europa/wasm_executor/" class="sidebar-link">Europa Wasm executor</a></li><li><a href="/substrate-contracts-book/en/europa/wasm_backtrace/" class="sidebar-link">/en/europa/wasm_backtrace/</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/substrate-contracts-book/en/zkmega/introduction" class="sidebar-heading clickable"><!----> <span class="title">zkMega</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/substrate-contracts-book/en/zkmega/tutorial/" class="sidebar-link">tutorial</a></li><li><a href="/substrate-contracts-book/en/zkmega/contract/" class="sidebar-link">Contract</a></li><li><a href="/substrate-contracts-book/en/zkmega/example/" class="sidebar-link">Example</a></li><li><a href="/substrate-contracts-book/en/zkmega/benchmark/" class="sidebar-link">Benchmark</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/substrate-contracts-book/en/himalia/introduction" class="sidebar-heading clickable"><!----> <span class="title">Himalia</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/substrate-contracts-book/en/himalia/tutorial/" class="sidebar-link">tutorial</a></li><li><a href="/substrate-contracts-book/en/himalia/go-patract/" class="sidebar-link">go-patract</a></li><li><a href="/substrate-contracts-book/en/himalia/py-patract/" class="sidebar-link">py-patract</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/substrate-contracts-book/en/metis/introduction" class="sidebar-heading clickable"><!----> <span class="title">Metis</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/substrate-contracts-book/en/metis/tokens/" class="sidebar-link">ERC20</a></li><li><a href="/substrate-contracts-book/en/metis/access-control/" class="sidebar-link">Access Control</a></li></ul></section></li><li><a href="/substrate-contracts-book/en/carpo/introduction/" class="sidebar-link">Carpo</a></li><li><a href="/substrate-contracts-book/en/patract/introduction/" class="sidebar-link">Patract</a></li><li><section class="sidebar-group depth-0"><a href="/substrate-contracts-book/en/elara/introduction" class="sidebar-heading clickable"><!----> <span class="title">Elara</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/substrate-contracts-book/en/elara/tutorial/" class="sidebar-link">Tutorial</a></li><li><a href="/substrate-contracts-book/en/elara/design/" class="sidebar-link">Design Brief</a></li><li><a href="/substrate-contracts-book/en/elara/API/" class="sidebar-link">API access</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/substrate-contracts-book/en/patra-store/introduction" class="sidebar-heading clickable"><!----> <span class="title">PatraStore</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/substrate-contracts-book/en/patra-store/overview/" class="sidebar-link">Overview</a></li><li><a href="/substrate-contracts-book/en/patra-store/getting-starter/" class="sidebar-link">Getting started</a></li><li><a href="/substrate-contracts-book/en/patra-store/publish-dapps/" class="sidebar-link">Publish DApp</a></li></ul></section></li></ul> </aside> <main class="page"><nav class="breadcrumb"><ol vocab="https://schema.org/" typeof="BreadcrumbList"><li property="itemListElement" typeof="ListItem"><a href="/substrate-contracts-book/en/" property="item" typeof="WebPage" class="router-link-active"><!----> <span property="name">Summary</span></a> <meta property="position" content="1"></li><li property="itemListElement" typeof="ListItem" class="is-active"><a href="/substrate-contracts-book/en/ink/edsl-basic/" aria-current="page" property="item" typeof="WebPage" class="router-link-exact-active router-link-active"><!----> <span property="name">ink! eDSL basic elements</span></a> <meta property="position" content="2"></li></ol></nav>  <div vocab="https://schema.org/" typeof="Article" class="page-title"><h1><!----> <span property="headline">ink! eDSL basic elements</span></h1> <div class="page-info"><!----> <!----><span aria-label="Writing Date📅" data-balloon-pos="down" class="time-info"><svg viewBox="0 0 1030 1024" xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 0 1-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 0 1-33.473-33.473V143.657H180.6A134.314 134.314 0 0 0 46.66 277.595v535.756A134.314 134.314 0 0 0 180.6 947.289h669.74a134.36 134.36 0 0 0 133.94-133.938V277.595a134.314 134.314 0 0 0-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 0 1-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 0 1-33.472 33.473z" fill="currentColor"></path></svg> <span property="datePublished">April 1, 2021 09:39</span></span><!----><span aria-label="Reading Time⌛" data-balloon-pos="down" class="reading-time-info"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon timer-icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z" fill="currentColor"></path></svg> <span>About 8 min</span> <meta property="timeRequired" content="PT8M"></span></div> <!----> <hr></div> <div class="anchor-place-holder"><aside id="anchor"><div class="anchor-wrapper"><ul class="anchor-list"><li class="anchor"><a href="/substrate-contracts-book/en/ink/edsl-basic/#elements-of-edsl" class="anchor-link heading2"><div>Elements of eDSL</div></a></li><li class="anchor"><a href="/substrate-contracts-book/en/ink/edsl-basic/#ink-contract" class="anchor-link heading3"><div>#[ink::contract]</div></a></li><li class="anchor"><a href="/substrate-contracts-book/en/ink/edsl-basic/#storage" class="anchor-link heading3"><div>storage</div></a></li><li class="anchor"><a href="/substrate-contracts-book/en/ink/edsl-basic/#constructor-message" class="anchor-link heading3"><div>constructor/message</div></a></li><li class="anchor"><a href="/substrate-contracts-book/en/ink/edsl-basic/#event" class="anchor-link heading3"><div>event</div></a></li></ul></div></aside></div> <div class="theme-default-content content__default"><h1 id="ink-edsl-basic-elements"><a href="#ink-edsl-basic-elements" class="header-anchor">#</a> ink! eDSL basic elements</h1> <p>The elements of ink! eDSL design are actually relatively similar to those of Solidity, because the contract model structure of Contracts Pallet and the contract model of EVM are relatively similar.</p> <p>Therefore, the design of ink! can find a lot of shadows similar to Solidity (the same applies to the Runtime design of Substrate). When describing the ink characteristics later, I will try to compare with the characteristics of Solidity, which is convenient for readers to understand.</p> <h2 id="elements-of-edsl"><a href="#elements-of-edsl" class="header-anchor">#</a> Elements of eDSL</h2> <p>From the example provided by ink! documentation or ink!, the code shows that ink! also proposes the following three basic elements on the Contracts Pallet model:</p> <ul><li><code>constructor</code>/<code>message</code></li> <li><code>storage</code></li> <li><code>event</code></li></ul> <p>However, due to the design relationship of the Rust process macro, you can see that ink! First requires a contract to be under a <code>mod</code>, and add the <code>#[ink::contract]</code> macro to this <code>mod</code>:</p> <div class="language-rust,ignore line-numbers-mode"><pre class="language-text"><code>#[ink::contract]
mod erc20 {
    // ...
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>In this way, it is equivalent to telling ink! What is in this mod is to be processed according to the eDSL of ink.</p> <h3 id="ink-contract"><a href="#ink-contract" class="header-anchor">#</a> <code>#[ink::contract]</code></h3> <p>Therefore, when you encounter the macro <code>#[ink::contract]</code>, it appears that this is the &quot;contract part&quot; identified by ink!. Therefore, we can see that many imports of <code>use xxx</code> will be placed under the scope of <code>mod</code> in <code>#[ink::contract]</code>.</p> <p>And the current ink! design is that, under a <code>crate</code> package, only one <code>#[ink::contract]</code> can appear, so it means that ink! thinks that the dimension of a contract is based on rust's <code>crate</code>, that is If in the same <code>crate</code>, whether in the same file (for example, under <code>lib.rs</code>) or in different files, more than two are defined by <code>#[ink::contract]</code> The <code>mod</code>, for example:</p> <div class="language-rust,ignore line-numbers-mode"><pre class="language-text"><code>#[ink::contract]
mod erc20 {
    // ...
}

#[ink::contract]
mod another_define {
    // ...
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>Analogous to solidity:</p> <div class="language-solidity,ignore line-numbers-mode"><pre class="language-text"><code>// a.sol defines multiple `contract` in the same file
contract A {

}
contract B {

}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>Then in the compilation of ink!, this situation will be considered illegal.</p> <p>Of course, as opposed to this, as long as there is only one <code>mod</code> modified by <code>#[ink::contract]</code> in the current <code>crate</code>, other <code>mod</code>s should be used normally, so the contract modified by ink! <code>crate</code> can still do a good job of code isolation, enhance readability and maintainability**. This ability is important for <strong>maintaining large and complex contracts</strong>, such as:</p> <div class="language-rust,ignore line-numbers-mode"><pre class="language-text"><code>#[ink::contract]
mod erc20 {
    use crete::another_define::*;
}

mod another_define {
    // ...
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>For example, the following example:</p> <div class="language-rust,ignore line-numbers-mode"><pre class="language-text"><code>mod fxck {
    use crate::erc20::Erc20;
    use ::ink_lang::Env; // Note that `ink_lang::Env` needs to be introduced here
    impl Erc20 {
        pub fn tmp(&amp;self) {
            self.env().caller(); // 
        }
    }
}

#[ink::contract]
mod erc20 {
    #[ink(storage)]
    pub struct Erc20 {...}

    impl Erc20 {
        #[ink(constructor)]
        pub fn new(initial_supply: Balance) -&gt; Self {...}
        #[ink(message)]
        pub fn transfer(&amp;mut self, initial_supply: Balance) -&gt; Self {
            self.tmp(); // call methods defined in other `mod`
        }
    }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p>This model can achieve some code isolation that cannot be done under Solidity, and enhance maintainability. (Because Solidity's library can only be used for pure function calculations)</p> <p>In summary, under the ink! system:</p> <ul><li>A contract is in a <code>crate</code> unit, and only one <code>#[ink::contract]</code> definition can appear in a <code>crate</code>;</li> <li><code>#[ink::contract]</code> modified <code>mod</code> represents the content of the contract, and also represents <strong>the basic elements of the contract must be defined under this <code>mod</code></strong>;</li> <li>All parts other than <code>mod</code> modified by <code>#[ink::contract]</code> (other <code>mod</code>, functions, types) follow the rules of rust, and good code isolation can be done to improve maintainability;</li> <li>In practice, the <code>mod</code> modified by <code>#[ink::contract]</code> can be used as the entry point of the contract, and the implemented logic can be distributed to other <code>mod</code>s.</li></ul> <p>The following uses &quot;contract mod&quot; to indicate a <code>mod</code> modified by <code>#[ink::contract]</code></p> <h3 id="storage"><a href="#storage" class="header-anchor">#</a> <code>storage</code></h3> <p>In the contract mod, a structure must be defined, and this structure is modified by <code>#[ink(storage)]</code>, indicating that the storage of the contract is defined.</p> <p>At the same time, this structure definition modified by <code>#[ink(storage)]</code> is also regarded as an operable contract entity**, so all contract-related resources, types, and operations will be ** and this structure The body is bound together**. When the contract calls the contract, the type of the called contract is also represented by this structure.</p> <p>Therefore, this structure can be understood as a contract entity.</p> <blockquote><p>Although the part that modifies <code>mod</code> is the contract, because <code>mod</code> can only represent the scope in rust, so for practical use, use the structure modified by <code>#[ink(storage)]</code> to indicate that it can be operated Contract entity.</p> <p>In this context, the <code>mod</code> modified by <code>#[ink::contract]</code> can be understood as the concept of &quot;opening the contract domain&quot;, while the <code>stuct</code> modified by <code>#[ink(storage)]</code> It is a contract under this contract domain.</p></blockquote> <p>Here, the concept of storage defined by ink! is consistent with the concept of “storage” defined in Solidity, which means that the attributes defined here are the final state written to the <strong>chain</strong>. The purpose of writing all contract logic is to modify the state defined here.</p> <p>However, because the current ink! uses a structure to carry the contract state, all the states of the current contract can only be defined in this structure. When the contract is designed to be relatively large and complicated, the maintainability here will decrease.</p> <p>An example of defining storage is as follows:</p> <div class="language-rust,ignore line-numbers-mode"><pre class="language-text"><code>#[ink(storage)]
pub struct Erc20 {
    /// Total token supply.
    total_supply: Lazy&lt;Balance&gt;,
    /// Mapping from owner to number of owned token.
    balances: StorageHashMap&lt;AccountId, Balance&gt;,
    /// Mapping of the token amount which an account is allowed to withdraw
    /// from another account.
    allowances: StorageHashMap&lt;(AccountId, AccountId), Balance&gt;,
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>Structures modified by <code>#[ink(storage)]</code> are collectively referred to as contract structures in the following text.</p> <p>Here are a few features that need to be paid special attention to:</p> <ol><li><p>The type of the attribute defined in the contract structure must be a type that has implemented <code>SpreadLayout</code> (or more accurately, a type that implements <code>PackedLayout</code>, because <code>PackedLayout</code> is inherited from the definition of <code>SpreadLayout</code>):</p> <div class="language-rust,ignore line-numbers-mode"><pre class="language-text"><code>/// Types that can be stored to and loaded from the contract storage.
pub trait SpreadLayout {
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><blockquote><p>The reason why only the type that implements this trait can be used here is very simple, because storage is different from the general type, it must contain the information of the &quot;chain&quot; in it, so the contract implementation of different chains must have a part for processing The storage (that is, state) allocation problem in the contract.</p> <p>For example, during the compilation process of Solidity, the key of the state is actually assigned according to the upper and lower order defined by the storage in the contract. If the <code>SpredLayout</code> or <code>PackedLayout</code> type has been implemented here, there will be an approximate process for state allocation.</p></blockquote> <p>Ink! has done basic implementations for general types, but <strong>for collection types (<code>Vec</code>, <code>HashMap</code>, etc.), because the state of the contract needs to hook the process of reading and writing</strong>, it cannot be implemented for collection types This <code>trait</code>. Therefore, in ink!, all the commonly used collection types in the standard library have been re-implemented, and the attribute types of the structure modified by <code>#[ink(storage)]</code> must be used if the collection type is used. The collection type provided by ink!**.</p> <blockquote><p>Since Solidity is relatively rudimentary, the storage map defined by Solidity cannot be traversed. (Caused by a defect in the Solidity design)</p> <p>ink! has done a lot of things when designing this piece, so the collection types <code>Vec</code>, <code>BTreeMap</code>, <code>HashMap</code> and so on provided by ink! are all <strong>traversable</strong>. Compared with the functions that Solidity can achieve, it is a considerable improvement.</p></blockquote></li> <li><p>Even based on the above design, the nested collection type is still difficult to implement (because the state structure of Substrate uses the k/v model). Therefore, in the design, we can only try to avoid nested collection types. If you must nest the collection type, you need to flatten the nesting level, merge the second-level key and the first-level key together, and use tuples instead (equivalent to <code>double_map</code> in Substrate Runtime)</p> <div class="language-Solidity,ignore line-numbers-mode"><pre class="language-text"><code>// solidity
contract A {
    mapping (uint =&gt; mapping (uint =&gt; uint))
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>The similar code in ink! should be:</p> <div class="language-rust,ignore line-numbers-mode"><pre class="language-text"><code>#[ink(storage)]
pub struct Erc20 {
    // Note that the key here uses the tuple `(AccountId, AccountId)`
    allowances: StorageHashMap&lt;(AccountId, AccountId), Balance&gt;,
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li> <li><p>A model of <code>Lazy</code> is provided in storage, which allows developers to use <code>Lazy</code> to wrap a type so that the state data can be loaded when it is used:</p> <div class="language-rust,ignore line-numbers-mode"><pre class="language-text"><code>/// A lazy storage entity.
///
/// This loads its value from storage upon first use.
///
/// # Note
///
/// Use this if the storage field doesn't need to be loaded in some or most cases.
#[derive(Debug)]
pub struct Lazy&lt;T&gt;
where
    T: SpreadLayout,
{
    cell: LazyCell&lt;T&gt;,
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>How to use:</p> <div class="language-rust,ignore line-numbers-mode"><pre class="language-text"><code>#[ink(storage)]
pub struct Erc20 {
    /// Total token supply.
    total_supply: Lazy&lt;Balance&gt;,
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li></ol> <h3 id="constructor-message"><a href="#constructor-message" class="header-anchor">#</a> <code>constructor</code>/<code>message</code></h3> <p><code>constructor</code>/<code>message</code> is the entry function that triggers the contract state change. In other words, <code>constructor</code>/<code>message</code> is the state transition function of the contract state.</p> <p><code>constructor</code>/<code>message</code> can only modify the methods of the contract structure**, and cannot be used to modify the methods of other structures or other pure functions.</p> <p>In the contract mod, there is at least one method for the contract structure modified by <code>constructor</code> and <code>message</code>. If there are less than one respectively, it will cause compilation error.</p> <p>among them:</p> <ul><li><p><code>constructor</code> corresponds to the constructor in the Solidity contract. When the contract is deployed (in Contracts Pallet currently represents the process of doing <code>instantiate</code> from the uploaded contract code), a call to the corresponding constructor will be triggered.</p> <blockquote><p>It needs to be emphasized here that the call of the constructor and the instantiation of the contract are two conceptual things. This process is <strong>not atomic</strong> in the coordination process of ink! and Contracts Pallet. Therefore, the constructor may not be called, but the contract address will be generated, and the contract instance for which the constructor has not been called can be called normally.</p> <p>A typical example is the wrong code parameter passed in when calling <code>instantiate</code>.</p></blockquote></li> <li><p><code>message</code> corresponds to the call methods such as <code>public</code>/<code>external</code> in the Solidity contract. Due to the characteristics of Rust's mutable/immutable methods, <code>message</code> uses the ** feature to indicate whether this method will modify the state of the contract**.</p> <p>So if the method of <code>message</code> modification is</p> <div class="language-rust,ignore line-numbers-mode"><pre class="language-text"><code>// Note that the first parameter of the method is `&amp;self`
#[ink(message)]
pub fn total_supply(&amp;self) -&gt; Balance {
    *self.total_supply
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>It means that the call of this method will not modify the state (controlled by the rust syntax), which is consistent with Ethereum. This type of method is mostly used for rpc calls to return the storage of a contract or return some storage-based calculation results.</p> <p>If the modification is</p> <div class="language-rust,ignore line-numbers-mode"><pre class="language-text"><code>// Note that the first parameter of the method is `&amp;mut self`
pub fn transfer(&amp;mut self, to: AccountId, value: Balance) -&gt; Result&lt;()&gt; {
    let from = self.env().caller();
    self.transfer_from_to(from, to, value)
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>It means that the call of this method will modify the state, so if this method is called and executed in the form of a packaged transaction call, it will trigger a state change. If it is called by rpc, it means that the simulation has been executed once.</p> <p>At the same time, metadata.json (corresponding to the ABI of Solidity) will be generated after the contract is compiled. In this metadata, there will be a <code>mutates</code> field for the message part to indicate whether the method is variable.</p></li></ul> <h4 id="message-s-selector"><a href="#message-s-selector" class="header-anchor">#</a> message's <code>selector</code></h4> <p>For the generation of the ABI of the contract method, Solidity uses the method name plus the parameter type as a function signature to piece together into a string and then make a hash to take the first 4 bytes.</p> <div class="language-text line-numbers-mode"><pre class="language-text"><code>call = &quot;func_name(param1_type,param2_type,...)&quot;
bytes4(keccak256(call), a, b)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>In ink!, this concept that allows contracts to distinguish call trigger points is called <code>selector</code>.</p> <p>Since rust does not support function overloading, a relatively simple design is adopted in ink!, which directly hashes the string of the function name and takes the first 4 bytes:</p> <div class="language-text line-numbers-mode"><pre class="language-text"><code>call = &quot;func_name&quot;
blake2_512(call)[0..4]
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><blockquote><p>The author believes that this design has caused problems with other contract language designs. Because rust does not support overloading, it does not mean that other languages ​​do not support overloading. After Solang compiles Solidity to Wasm, if it wants to be compatible with ink!'s metadata, problems will arise when calling each other.</p></blockquote> <p>On the other hand, <code>selector</code> can also run the contract developer's own definition</p> <div class="language-rust,json line-numbers-mode"><pre class="language-text"><code>#[ink(message, selector = &quot;0xCAFEBABE&quot;)]
pub fn was_it_ten(&amp;self) -&gt; bool {...}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="message-of-payable"><a href="#message-of-payable" class="header-anchor">#</a> message of <code>payable</code></h4> <p>There is a <code>payable</code> modifier for the method in Solidity, which is used to indicate that the method can accept a certain amount of money.</p> <p>Therefore, <code>payable</code> is also provided in ink! to indicate whether it is possible to transfer a certain amount of <strong>local currency</strong> while calling this method. In the current design of ink!, if a non-payable message is called with an amount at the same time, the calling process will be regarded as an error.</p> <p>By default, <code>paybale</code> is considered to be <code>false</code>, and it is <code>true</code> only when the contract developer specifies <code>payable</code>.</p> <p>The case for specifying a message to be callable is:</p> <div class="language-rust,json line-numbers-mode"><pre class="language-text"><code>#[ink(message, playable)]
pub fn was_it_ten(&amp;self) -&gt; bool {...}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>On the other hand, in metadata, there will be a <code>payable</code> field for the message part to indicate whether this method requires payment.</p> <h3 id="event"><a href="#event" class="header-anchor">#</a> <code>event</code></h3> <p>The concept of event is not necessary in the state machine model. However, because <strong>blockchain is an asynchronous system</strong>, after sending a transaction to trigger a state change, the result of the change cannot be immediately known, and it can only rely on monitoring an element to determine the execution result. <code>event</code> is an element designed at the stage of Solidity, and this design is also inherited from Substrate Runtime and ink!.</p> <blockquote><p>I don't think event is a good design. In theory, there are other better ways, or variants of event. Event will cause abuse by developers to a certain extent.</p></blockquote> <p>The <code>event</code> of ink! in Contracts Pallet finally prints the event defined by the contract to the event of the chain through the <code>host function</code>.</p> <p>The event design of ink! is nothing special compared to Solidity, but because it is a contract running in Wasm, the event of the printing contract needs to interact with the chain through the host function, so the calling method needs to be passed through. env()` to call.</p> <div class="language-rust,ignore line-numbers-mode"><pre class="language-text"><code>Self::env().emit_event(...);
// or use
self.env().emit_event(...);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></div> <footer class="page-meta"><div class="edit-link"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon edit-icon"><path d="M117.953 696.992 64.306 959.696l265.931-49.336 450.204-452.505-212.284-213.376-450.204 452.513zm496.384-296.326L219.039 797.993l-46.108-46.34L568.233 354.33l46.104 46.335zm345.357-122.99-114.45 115.04-212.288-213.377 114.45-115.035 212.288 213.371zm0 0" fill="currentColor"></path></svg> <a href="https://github.com/patractlabs/substrate-contracts-book/edit/master/en/ink/edsl-basic.md" target="_blank" rel="noopener noreferrer">Edit this page</a></div> <div class="meta-item update-time"><span class="label">Last update:</span> <span class="info">April 1, 2021 09:39</span></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev"><a href="/substrate-contracts-book/en/ink/framework/" class="prev"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon prev-icon"><path d="M906.783 588.79c-.02 8.499-6.882 15.36-15.38 15.37l-443.7-.01 75.704 191.682c2.52 6.42.482 13.763-5.038 17.91-5.52 4.168-13.138 4.147-18.616-.092L123.228 524.175a15.362 15.362 0 0 1-6-12.165c0-4.782 2.222-9.277 6-12.185L499.753 210.35a15.388 15.388 0 0 1 9.38-3.195c3.236 0 6.502 1.034 9.236 3.103 5.52 4.147 7.578 11.49 5.038 17.91L447.683 419.84l443.72-.01c8.498.01 15.36 6.881 15.36 15.36l.02 153.6z" fill="currentColor"></path></svg>
        ink! Framework
      </a></span> <span class="next"><a href="/substrate-contracts-book/en/ink/call-contracts/">
        ink! 跨合约调用
        <svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon next-icon"><path d="M906.772 512c0 4.772-2.211 9.267-5.99 12.175L524.257 813.66a15.37 15.37 0 0 1-18.616.092 15.368 15.368 0 0 1-5.038-17.91l75.714-191.672h-443.73c-8.488 0-15.36-6.881-15.36-15.36v-153.6c0-8.489 6.872-15.36 15.36-15.36h443.73l-75.714-191.682a15.358 15.358 0 0 1 5.048-17.91c5.51-4.158 13.128-4.137 18.606.092l376.525 289.485a15.323 15.323 0 0 1 5.99 12.165z" fill="currentColor"></path></svg></a></span></p></div> <!----> </main> <footer class="footer-wrapper"><!----> <div class="footer">PatractLabs</div> <div class="copyright">Copyright © 2020 patractlabs</div></footer></div><div class="global-ui"><!----><!----><div id="pwa-install"><!----> <div id="install-modal-wrapper" style="display:none;"><div class="background"></div> <div class="install-modal"><div class="header"><button aria-label="Close" class="close-button"><svg width="23" height="22" xmlns="http://www.w3.org/2000/svg" class="icon close-icon"><path fill-rule="evenodd" clip-rule="evenodd" d="M1.12.358a1.224 1.224 0 011.729 0l8.92 8.914L20.686.358a1.224 1.224 0 011.73 1.728L13.497 11l8.92 8.913a1.222 1.222 0 11-1.73 1.729l-8.919-8.913-8.92 8.913a1.224 1.224 0 01-1.729-1.729L10.04 11l-8.92-8.914a1.222 1.222 0 010-1.728z" fill="currentColor"></path></svg></button> <div class="logo"><!----> <div class="title"><h1></h1> <p class="desc">This app can be installed on your PC or mobile device.  This will allow this web app to look and behave like any other installed app.  You will find it in your app lists and be able to pin it to your home screen, start menus or task bars.  This installed web app will also be able to safely interact with other apps and your operating system. </p></div></div></div> <div class="content"><div class="highlight"><!----> <!----></div> <div class="description"><h3>Description</h3> <p></p></div></div> <div class="button-wrapper"><button class="install-button">
        Install <span></span></button> <button class="cancel-button">
        Cancel
      </button></div></div></div></div><div tabindex="-1" role="dialog" aria-hidden="true" class="pswp"><div class="pswp__bg"></div> <div class="pswp__scroll-wrap"><div class="pswp__container"><div class="pswp__item"></div> <div class="pswp__item"></div> <div class="pswp__item"></div></div> <div class="pswp__ui pswp__ui--hidden"><div class="pswp__top-bar"><div class="pswp__counter"></div> <button title="Close (Esc)" class="pswp__button pswp__button--close"></button> <button title="Share" class="pswp__button pswp__button--share"></button> <button title="Toggle fullscreen" class="pswp__button pswp__button--fs"></button> <button title="Zoom in/out" class="pswp__button pswp__button--zoom"></button> <div class="pswp__preloader"><div class="pswp__preloader__icn"><div class="pswp__preloader__cut"><div class="pswp__preloader__donut"></div></div></div></div></div> <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class="pswp__share-tooltip"></div></div> <button title="Previous (arrow left)" class="pswp__button pswp__button--arrow--left"></button> <button title="Next (arrow right)" class="pswp__button pswp__button--arrow--right"></button> <div class="pswp__caption"><div class="pswp__caption__center"></div></div></div></div></div></div></div>
    <script src="/substrate-contracts-book/assets/js/app.9e416bbf.js" defer></script><script src="/substrate-contracts-book/assets/js/layout-Layout.c63f724a.js" defer></script><script src="/substrate-contracts-book/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound.dd92595a.js" defer></script><script src="/substrate-contracts-book/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound~layout-Slide.d464c7d8.js" defer></script><script src="/substrate-contracts-book/assets/js/vendors~layout-Blog~layout-Layout.fa83db2a.js" defer></script><script src="/substrate-contracts-book/assets/js/page-ink!eDSLbasicelements.7a41db2d.js" defer></script>
  </body>
</html>
